---
title: docker命令
layout: post
tags: docker
categories: ''
---

#### 帮助命令

```shell
docker version # 显示版本信息
docker info    # 显示docker系统信息，包括镜像数量、容器数量
```

#### 镜像命令

**docker images** 

```shell
zhengkan03@ubuntu:~/桌面$ docker images
REPOSITORY                TAG       IMAGE ID       CREATED         SIZE
<none>                    <none>    fa7b17d27d4a   3 months ago    2.74GB
windspeed                 latest    ed0455db2d73   3 months ago    2.22GB

# 解释
REPOSITORY   镜像的仓库源
TAG			镜像的标签
IMAGE ID   	镜像ID
CREATED    	镜像的创建时间
SIZE      	镜像的大小
```

***

**docker search** 搜索镜像

```shell
(base) zhengkan03@ubuntu:~/桌面$ docker search mysql --filter=STARS=3000
NAME      DESCRIPTION                                     STARS     OFFICIAL   AUTOMATED
mysql     MySQL is a widely used, open-source relation…   11023     [OK]       
mariadb   MariaDB Server is a high performing open sou…   4177      [OK]  

# 解释
可选项 --filter=STARS=3000 搜索星星大于3000的镜像
```

**docker pull**下载镜像

```shell
# 下载最新版本
(base) zhengkan03@ubuntu:~/桌面$ docker pull mysql
Using default tag: latest
latest: Pulling from library/mysql
69692152171a: Pull complete       # 分层下载
1651b0be3df3: Pull complete 
951da7386bc8: Pull complete 
0f86c95aa242: Pull complete 
37ba2d8bd4fe: Pull complete 
6d278bb05e94: Pull complete 
497efbd93a3e: Pull complete 
f7fddf10c2c2: Pull complete 
16415d159dfb: Pull complete 
0e530ffc6b73: Pull complete 
b0a4a1a77178: Pull complete 
cd90f92aa9ef: Pull complete 
Digest: sha256:d50098d7fcb25b1fcb24e2d3247cae3fc55815d64fec640dc395840f8fa80969
Status: Downloaded newer image for mysql:latest
docker.io/library/mysql:latest

# 等价
# docker pull mysql 
# docker pull docker.io/library/mysql:latest

# 下载指定版本
# docker pull 镜像名[:版本号]
# docker pull mysql:5.7
```

**docker rmi 镜像名** 删除镜像

```shell
# docker rmi 镜像名
docker rmi 镜像id
docker rmi -f 镜像id 					# 强制删除镜像
docker rmi -f $(docker ps -aq)         # 删除所有镜像
```

#### 容器命令

**docker run [可选参数] **

```shell
docker run [可选参数] image

# 参数说明
--name="Name"   指定运行镜像后的容器名字 tomcat01 
-d 			   后台方式运行
-it			   使用交互方式，进入容器内部
-p			  指定容器端口 -p 8000::8080
	-p ip:主机端口:容器端口
	-p 主机端口:容器端口 （常用）
	-p 容器端口:容器端口
-P 			   随机指定端口
# 运行并进入容器
 zhengkan03@ubuntu:~/桌面$ docker run -it centos /bin/bash
```

**docker ps** 列出容器

```shell
docker ps
	# 列出当前正在运行的容器
-a  # 列出所有容器【历史的容器+正在运行的容器】
-q  # 只显示容器编号

```

**退出容器**

```shell
exit  # 直接容器停止并退出
CTRL + P + Q # 容器不停止，退出
```

**删除容器**

```shell
docker rm 容器id					# 删除指定容器 ，不能删除正在运行的容器
docker rm -f $(docker ps -aq)	   # 删除所有容器
```

**启动容器和停止容器**

```shell
docker start 容器id
docker restart 容器id
docker stop 容器id
docker kill 容器id  # 强制停止当前容器
```

```常用的命令

```shell
# 查看日志
docker logs 
docker logs -tf -tail n 容器id   # 查看最后n条日志  -t 显示时间戳   -f 跟随时间戳

# 示例
zhengkan03@ubuntu:~/桌面$ docker logs -tf --tail 10 26b6aea91aaa
2021-06-22T07:48:50.905093443Z 
2021-06-22T07:48:50.905095407Z To try something more ambitious, you can run an Ubuntu container with:
2021-06-22T07:48:50.905097543Z  $ docker run -it ubuntu bash
2021-06-22T07:48:50.905099590Z 
2021-06-22T07:48:50.905101646Z Share images, automate workflows, and more with a free Docker ID:
2021-06-22T07:48:50.905103754Z  https://hub.docker.com/
2021-06-22T07:48:50.905105835Z 
2021-06-22T07:48:50.905107823Z For more examples and ideas, visit:
2021-06-22T07:48:50.905109929Z  https://docs.docker.com/get-started/
2021-06-22T07:48:50.905112002Z 
```

```shell
# 查看进程信息
docker top 容器id

# 示例
hengkan03@ubuntu:~/桌面$ docker top ffbdccd23b40
UID                 PID                 PPID                C                   STIME               TTY             
root                4003                3981                1                   16:02               ?               
root                4048                4003                2                   16:02               ?               
```

```shell
# 查看容器元数据
docker inspect 容器id
# 示例
zhengkan03@ubuntu:~/桌面$ docker inspect ffbdccd23b40
[
    {
        "Id": "ffbdccd23b400f0e42060189c76b8497b6b97911c1bd98937d57417ea7751496",
        "Created": "2021-06-22T08:02:15.072353163Z",
        "Path": "python3",
        "Args": [
            "WindPlatform.py"
        ],
        "State": {
            "Status": "running",
            "Running": true,
            "Paused": false,
            "Restarting": false,
            "OOMKilled": false,
            "Dead": false,
            "Pid": 4003,
            "ExitCode": 0,
            "Error": "",
            "StartedAt": "2021-06-22T08:02:15.329542854Z",
            "FinishedAt": "0001-01-01T00:00:00Z"
        },
        "Image": "sha256:fa7b17d27d4a5dffbfef573effc6c11f8e08050df1d5479d58196a9d3e57e3e4",
        "ResolvConfPath": "/var/lib/docker/containers/ffbdccd23b400f0e42060189c76b8497b6b97911c1bd98937d57417ea7751496/resolv.conf",
        "HostnamePath": "/var/lib/docker/containers/ffbdccd23b400f0e42060189c76b8497b6b97911c1bd98937d57417ea7751496/hostname",
        "HostsPath": "/var/lib/docker/containers/ffbdccd23b400f0e42060189c76b8497b6b97911c1bd98937d57417ea7751496/hosts",
        "LogPath": "/var/lib/docker/containers/ffbdccd23b400f0e42060189c76b8497b6b97911c1bd98937d57417ea7751496/ffbdccd23b400f0e42060189c76b8497b6b97911c1bd98937d57417ea7751496-json.log",
        "Name": "/nifty_euclid",
        "RestartCount": 0,
        "Driver": "overlay2",
        "Platform": "linux",
        "MountLabel": "",
        "ProcessLabel": "",
        "AppArmorProfile": "docker-default",
        "ExecIDs": null,
        "HostConfig": {
            "Binds": null,
            "ContainerIDFile": "",
            "LogConfig": {
                "Type": "json-file",
                "Config": {}
            },
            "NetworkMode": "default",
            "PortBindings": {},
            "RestartPolicy": {
                "Name": "no",
                "MaximumRetryCount": 0
            },
            "AutoRemove": false,
            "VolumeDriver": "",
            "VolumesFrom": null,
            "CapAdd": null,
            "CapDrop": null,
            "CgroupnsMode": "host",
            "Dns": [],
            "DnsOptions": [],
            "DnsSearch": [],
            "ExtraHosts": null,
            "GroupAdd": null,
            "IpcMode": "private",
            "Cgroup": "",
            "Links": null,
            "OomScoreAdj": 0,
            "PidMode": "",
            "Privileged": false,
            "PublishAllPorts": false,
            "ReadonlyRootfs": false,
            "SecurityOpt": null,
            "UTSMode": "",
            "UsernsMode": "",
            "ShmSize": 67108864,
            "Runtime": "runc",
            "ConsoleSize": [
                0,
                0
            ],
            "Isolation": "",
            "CpuShares": 0,
            "Memory": 0,
            "NanoCpus": 0,
            "CgroupParent": "",
            "BlkioWeight": 0,
            "BlkioWeightDevice": [],
            "BlkioDeviceReadBps": null,
            "BlkioDeviceWriteBps": null,
            "BlkioDeviceReadIOps": null,
            "BlkioDeviceWriteIOps": null,
            "CpuPeriod": 0,
            "CpuQuota": 0,
            "CpuRealtimePeriod": 0,
            "CpuRealtimeRuntime": 0,
            "CpusetCpus": "",
            "CpusetMems": "",
            "Devices": [],
            "DeviceCgroupRules": null,
            "DeviceRequests": null,
            "KernelMemory": 0,
            "KernelMemoryTCP": 0,
            "MemoryReservation": 0,
            "MemorySwap": 0,
            "MemorySwappiness": null,
            "OomKillDisable": false,
            "PidsLimit": null,
            "Ulimits": null,
            "CpuCount": 0,
            "CpuPercent": 0,
            "IOMaximumIOps": 0,
            "IOMaximumBandwidth": 0,
            "MaskedPaths": [
                "/proc/asound",
                "/proc/acpi",
                "/proc/kcore",
                "/proc/keys",
                "/proc/latency_stats",
                "/proc/timer_list",
                "/proc/timer_stats",
                "/proc/sched_debug",
                "/proc/scsi",
                "/sys/firmware"
            ],
            "ReadonlyPaths": [
                "/proc/bus",
                "/proc/fs",
                "/proc/irq",
                "/proc/sys",
                "/proc/sysrq-trigger"
            ]
        },
        "GraphDriver": {
            "Data": {
                "LowerDir": "/var/lib/docker/overlay2/683812c5b66d7ff4a6efc7479adf1d1dd69ef966d721104cb240fc810d023f7d-init/diff:/var/lib/docker/overlay2/17a7729fae872dc47beaddd86c02f5a95d1c8b17525e49e9457ff52e126dfc17/diff:/var/lib/docker/overlay2/fa10d11839ed464f0bd78ba5d9cb8fef8212e391876569631c0c04a59aa6e3e3/diff:/var/lib/docker/overlay2/b3c96094f9204af39890d1b8101278a98d7cc6c9c96e76c8fa2efb19d6181a0b/diff:/var/lib/docker/overlay2/c8fe8f5fd4e56531f6452da6ad5e8d300f2b48042a0c72a18fe4e11b3a369aec/diff:/var/lib/docker/overlay2/d28d47c24554c918e4814ef21087b7b334d6b02055c22a690714d9fe905d2407/diff:/var/lib/docker/overlay2/7343c35e91fb791e62ec43253c0ae1705b54dbe72ab65b1361e3a33f7bea1610/diff:/var/lib/docker/overlay2/1ff46c566494d2451a35636d7b28461d0ea2f2c2dd2af2920de52ee25ba53529/diff:/var/lib/docker/overlay2/e736e69f6bb2b87efb5ff8d693c4fd37d887502a06a5b9fabff96ad8153c7f9c/diff:/var/lib/docker/overlay2/18a19eee18a38481e0db17be63f675b6edddba3c72f6ec3ea99b2446b44198c8/diff:/var/lib/docker/overlay2/1cab6ed396a099774fbf46013adbb04aae80e173af01b08bbaebd4330ee5417e/diff:/var/lib/docker/overlay2/0a990a330b637a03878dece926106670d67a6848220433163e8b614e26a4d5fe/diff:/var/lib/docker/overlay2/dcb2bdf25e93fc854e9f20db7af8a15d8121591d0fdc4adf6fd3897c6ad42794/diff:/var/lib/docker/overlay2/32ff4d2f742d16b700a2e71d3e6c4508a976046869a472e52fb7057e2bab2f6c/diff:/var/lib/docker/overlay2/09f6a5b7a03f34cd7ddd7fab9ba8fe9aa3ddf9e232fabf3c54fc8602d80a2f1f/diff",
                "MergedDir": "/var/lib/docker/overlay2/683812c5b66d7ff4a6efc7479adf1d1dd69ef966d721104cb240fc810d023f7d/merged",
                "UpperDir": "/var/lib/docker/overlay2/683812c5b66d7ff4a6efc7479adf1d1dd69ef966d721104cb240fc810d023f7d/diff",
                "WorkDir": "/var/lib/docker/overlay2/683812c5b66d7ff4a6efc7479adf1d1dd69ef966d721104cb240fc810d023f7d/work"
            },
            "Name": "overlay2"
        },
        "Mounts": [
            {
                "Type": "volume",
                "Name": "506ba62d402f692daf45dad5a846cff4e553a710f541e78949466e0e92325ea9",
                "Source": "/var/lib/docker/volumes/506ba62d402f692daf45dad5a846cff4e553a710f541e78949466e0e92325ea9/_data",
                "Destination": "/sys/fs/cgroup",
                "Driver": "local",
                "Mode": "",
                "RW": true,
                "Propagation": ""
            }
        ],
        "Config": {
            "Hostname": "ffbdccd23b40",
            "Domainname": "",
            "User": "",
            "AttachStdin": false,
            "AttachStdout": false,
            "AttachStderr": false,
            "Tty": false,
            "OpenStdin": false,
            "StdinOnce": false,
            "Env": [
                "PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin",
                "container=docker",
                "DEBIAN_FRONTEND=noninteractive",
                "LANG=en_US.UTF-8",
                "LANGUAGE=en_US:en",
                "LC_ALL=en_US.UTF-8"
            ],
            "Cmd": [
                "python3",
                "WindPlatform.py"
            ],
            "Image": "fa7b17d27d4a",
            "Volumes": {
                "/sys/fs/cgroup": {}
            },
            "WorkingDir": "/app",
            "Entrypoint": null,
            "OnBuild": null,
            "Labels": {}
        },
        "NetworkSettings": {
            "Bridge": "",
            "SandboxID": "5f09b2026536f58852715967f0f1487828195533aa71896838e9074634e2a403",
            "HairpinMode": false,
            "LinkLocalIPv6Address": "",
            "LinkLocalIPv6PrefixLen": 0,
            "Ports": {},
            "SandboxKey": "/var/run/docker/netns/5f09b2026536",
            "SecondaryIPAddresses": null,
            "SecondaryIPv6Addresses": null,
            "EndpointID": "d88f24d5ea6a94c7a9ee0359d7bd829cf66e4dc70ebe7d827b709a8c0a836dd2",
            "Gateway": "172.17.0.1",
            "GlobalIPv6Address": "",
            "GlobalIPv6PrefixLen": 0,
            "IPAddress": "172.17.0.2",
            "IPPrefixLen": 16,
            "IPv6Gateway": "",
            "MacAddress": "02:42:ac:11:00:02",
            "Networks": {
                "bridge": {
                    "IPAMConfig": null,
                    "Links": null,
                    "Aliases": null,
                    "NetworkID": "8f3b1769f0151de1a0edac3bf15a02e0828f2ea16919098ec4cdfd43f0f90ad4",
                    "EndpointID": "d88f24d5ea6a94c7a9ee0359d7bd829cf66e4dc70ebe7d827b709a8c0a836dd2",
                    "Gateway": "172.17.0.1",
                    "IPAddress": "172.17.0.2",
                    "IPPrefixLen": 16,
                    "IPv6Gateway": "",
                    "GlobalIPv6Address": "",
                    "GlobalIPv6PrefixLen": 0,
                    "MacAddress": "02:42:ac:11:00:02",
                    "DriverOpts": null
                }
            }
        }
    }
]

```

```shell
# 进入容器
docker exec -it 容器id /bin/bash

# 示例
zhengkan03@ubuntu:~/桌面$ docker exec -it  ffbdccd23b40 /bin/bash
root@ffbdccd23b40:/app# ls
data  Dockerfile  LSTM.py  __pycache__  README.md  requirements.txt  static  templates  WindPlatform.py

# 进入容器
docker attach

# 区别
docker exec       # 进入容器后开启一个新的终端
docker attach	  # 进入容器正在执行的终端，不会启动新的进程
```

```shell
# 容器内文件拷贝到主机 	
docker cp 容器id:路径 宿主机路径
# 示例
zhengkan03@ubuntu:~/桌面$ docker cp ffbdccd23b40:/app/ /home/zhengkan03/Desktop/
```

#### 作业 部署nginx

```sh
# 启动容器
zhengkan03@ubuntu:~/桌面$ docker run -d -p 3344:80 nginx       # 3344为本地端口，80为容器nginx的端口

# 访问nginx
zhengkan03@ubuntu:~/桌面$ curl localhost:3344
<!DOCTYPE html>
<html>
<head>
<title>Welcome to nginx!</title>
<style>
    body {
        width: 35em;
        margin: 0 auto;
        font-family: Tahoma, Verdana, Arial, sans-serif;
    }
</style>
</head>
<body>
<h1>Welcome to nginx!</h1>
<p>If you see this page, the nginx web server is successfully installed and
working. Further configuration is required.</p>

<p>For online documentation and support please refer to
<a href="http://nginx.org/">nginx.org</a>.<br/>
Commercial support is available at
<a href="http://nginx.com/">nginx.com</a>.</p>

<p><em>Thank you for using nginx.</em></p>
</body>
</html>

```

**commit镜像**

```shell
# 将容器打包为镜像
docker commit -m="提交的内容说明" -a="作者" 容器id 目标镜像名:版本号（tag）
```

#### 容器数据卷

docker的理念： 将应用和环境打包为一个镜像！

数据，如果保存在容器中，那么容器被删除，数据就会丢失。 **需求** 数据的持久化

MySQL 容器删了，删库跑路！ **需求** MySQL数据需要存储到本地

**总结一句话：容器的持久化和同步话操作！ 容器间可以数据共享**

##### 1.使用数据卷

>方式一：直接使用-v数据挂载;  功能是实现双向绑定
>
>容器内部添加文件，可同步到主机
>
>主机指定文件夹下添加文件可同步到容器内

```shell
docker run -it -v 主机目录:容器内目录

# 启动后可以通过docker inspect 容器id 查看挂载->Mount
```

##### 2.实战：安装mysql

```shell
# 获取镜像
zhengkan03@ubuntu:~$ docker pull mysql:5.7
# 运行容器，需要做数据挂载，安装启动mysql，需要配置密码，这是注意点！
# 官方测试 docker run --name some-mysql -e MYSQL_ROOT_PASSWORD=my-secret-pw -d mysql:tag

zhengkan03@ubuntu:~$ docker run -d -p 3310:3306 -v /home/mysql/conf:/etc/mysql/conf.d -v /home/mysql/data:/var/lib/mysql -e MYSQL_ROOT_PASSWORD=123456 --name mysql01 mysql:5.7

# 运行成功，启动测试
```

<img src=".\images\image-20210622194742910.png" alt="image-20210622194742910" style="zoom:50%;" />

连接成功，没有问题！

此时，如果删除容器，也不会删除本地文件，从而实现文件的持久化！

##### 3.具名挂载和匿名挂载

```sh
# 匿名挂载
docker run -d -P --name nginx -v 
-v 容器内路径  # 匿名挂载
-v 卷名:容器内路径  # 具名挂载
-v /宿主机路径:容器内路径  # 指定路径挂载

# 通过 -v 容器内路径：ro rw 改变读写权限  ，设置后只能通过宿主机操作，不能容器内操作
ro  readonly
rw  
```







#### DockerFile

#### Dokcer网络

