---
title: Jinja2
layout: post
tags: Flask
categories: ''
---

## Flask中Jinja2模板引擎详解

http://www.bjhee.com/jinja2-statement.html

### 1.Flask渲染Jinja2模板和传参：
1. 如何渲染模板：
    * 模板放在`templates`文件夹下
    * 从`flask`中导入`render_template`函数。
    * 在视图函数中，使用`render_template`函数，渲染模板。注意：只需要填写模板的名字，不需要填写`templates`这个文件夹的路径。
    
2. 模板传参：
    * 如果只有一个或者少量参数，直接在`render_template`函数中添加关键字参数就可以了。
    * 如果有多个参数的时候，那么可以先把所有的参数放在字典中，然后在`render_template`中，
    使用两个星号，把字典转换成关键参数传递进去，这样的代码更方便管理和使用。
    
3. 在模板中，如果要使用一个变量，语法是：

    ```jinja2
    {{params}}
    ```

4. 访问模型中的属性或者是字典，可以通过`{{params.property}}`的形式，或者是使用`{{params['age']}}`. 

### 2.过滤器：

​	**过滤器很重要，在jinja处理问题的时候用的比较多，需要灵活掌握**

1. 介绍和语法：
    * 介绍：过滤器可以处理变量，把原始的变量经过处理后再展示出来。作用的对象是变量。
    * 语法：
        ```jinja2
        {{ avatar|default('xxx') }}
        ```
    
2. default过滤器：如果当前变量不存在，这时候可以指定默认值。

3. length过滤器：求列表或者字符串或者字典或者元组的长度。

4. 常用的过滤器：
   
    | [`abs()`](https://jinja.palletsprojects.com/en/2.10.x/templates/#abs) | [`float()`](https://jinja.palletsprojects.com/en/2.10.x/templates/#float) | [`lower()`](https://jinja.palletsprojects.com/en/2.10.x/templates/#lower) | [`round()`](https://jinja.palletsprojects.com/en/2.10.x/templates/#round) | [`tojson()`](https://jinja.palletsprojects.com/en/2.10.x/templates/#tojson) |
    | ------------------------------------------------------------ | ------------------------------------------------------------ | ------------------------------------------------------------ | ------------------------------------------------------------ | ------------------------------------------------------------ |
    | [`attr()`](https://jinja.palletsprojects.com/en/2.10.x/templates/#attr) | [`forceescape()`](https://jinja.palletsprojects.com/en/2.10.x/templates/#forceescape) | [`map()`](https://jinja.palletsprojects.com/en/2.10.x/templates/#map) | [`safe()`](https://jinja.palletsprojects.com/en/2.10.x/templates/#safe) | [`trim()`](https://jinja.palletsprojects.com/en/2.10.x/templates/#trim) |
    | [`batch()`](https://jinja.palletsprojects.com/en/2.10.x/templates/#batch) | [`format()`](https://jinja.palletsprojects.com/en/2.10.x/templates/#format) | [`max()`](https://jinja.palletsprojects.com/en/2.10.x/templates/#max) | [`select()`](https://jinja.palletsprojects.com/en/2.10.x/templates/#select) | [`truncate()`](https://jinja.palletsprojects.com/en/2.10.x/templates/#truncate) |
    | [`capitalize()`](https://jinja.palletsprojects.com/en/2.10.x/templates/#capitalize) | [`groupby()`](https://jinja.palletsprojects.com/en/2.10.x/templates/#groupby) | [`min()`](https://jinja.palletsprojects.com/en/2.10.x/templates/#min) | [`selectattr()`](https://jinja.palletsprojects.com/en/2.10.x/templates/#selectattr) | [`unique()`](https://jinja.palletsprojects.com/en/2.10.x/templates/#unique) |
    | [`center()`](https://jinja.palletsprojects.com/en/2.10.x/templates/#center) | [`indent()`](https://jinja.palletsprojects.com/en/2.10.x/templates/#indent) | [`pprint()`](https://jinja.palletsprojects.com/en/2.10.x/templates/#pprint) | [`slice()`](https://jinja.palletsprojects.com/en/2.10.x/templates/#slice) | [`upper()`](https://jinja.palletsprojects.com/en/2.10.x/templates/#upper) |
    | [`default()`](https://jinja.palletsprojects.com/en/2.10.x/templates/#default) | [`int()`](https://jinja.palletsprojects.com/en/2.10.x/templates/#int) | [`random()`](https://jinja.palletsprojects.com/en/2.10.x/templates/#random) | [`sort()`](https://jinja.palletsprojects.com/en/2.10.x/templates/#sort) | [`urlencode()`](https://jinja.palletsprojects.com/en/2.10.x/templates/#urlencode) |
    | [`dictsort()`](https://jinja.palletsprojects.com/en/2.10.x/templates/#dictsort) | [`join()`](https://jinja.palletsprojects.com/en/2.10.x/templates/#join) | [`reject()`](https://jinja.palletsprojects.com/en/2.10.x/templates/#reject) | [`string()`](https://jinja.palletsprojects.com/en/2.10.x/templates/#string) | [`urlize()`](https://jinja.palletsprojects.com/en/2.10.x/templates/#urlize) |
  | [`escape()`](https://jinja.palletsprojects.com/en/2.10.x/templates/#escape) | [`last()`](https://jinja.palletsprojects.com/en/2.10.x/templates/#last) | [`rejectattr()`](https://jinja.palletsprojects.com/en/2.10.x/templates/#rejectattr) | [`striptags()`](https://jinja.palletsprojects.com/en/2.10.x/templates/#striptags) | [`wordcount()`](https://jinja.palletsprojects.com/en/2.10.x/templates/#wordcount) |
    | [`filesizeformat()`](https://jinja.palletsprojects.com/en/2.10.x/templates/#filesizeformat) | [`length()`](https://jinja.palletsprojects.com/en/2.10.x/templates/#length) | [`replace()`](https://jinja.palletsprojects.com/en/2.10.x/templates/#replace) | [`sum()`](https://jinja.palletsprojects.com/en/2.10.x/templates/#sum) | [`wordwrap()`](https://jinja.palletsprojects.com/en/2.10.x/templates/#wordwrap) |
    | [`first()`](https://jinja.palletsprojects.com/en/2.10.x/templates/#first) | [`list()`](https://jinja.palletsprojects.com/en/2.10.x/templates/#list) | [`reverse()`](https://jinja.palletsprojects.com/en/2.10.x/templates/#reverse) | [`title()`](https://jinja.palletsprojects.com/en/2.10.x/templates/#title) | [`xmlattr()`](https://jinja.palletsprojects.com/en/2.10.x/templates/#xmlattr) |
    
    ```jinja2
    abs(value)：返回一个数值的绝对值。示例：-1|abs
    default(value,default_value,boolean=false)：如果当前变量没有值，则会使用参数中的值来代替。示例：name|default('xiaotuo')——如果name不存在，则会使用xiaotuo来替代。boolean=False默认是在只有这个变量为undefined的时候才会使用default中的值，如果想使用python的形式判断是否为false，则可以传递boolean=true。也可以使用or来替换。
    escape(value)或e：转义字符，会将<、>等符号转义成HTML中的符号。示例：content|escape或content|e。
    first(value)：返回一个序列的第一个元素。示例：names|first
    format(value,*arags,**kwargs)：格式化字符串。比如：
    
      {{ "%s" - "%s"|format('Hello?',"Foo!") }}
      将输出：Helloo? - Foo!
    last(value)：返回一个序列的最后一个元素。示例：names|last。
    
    length(value)：返回一个序列或者字典的长度。示例：names|length。
    join(value,d=u'')：将一个序列用d这个参数的值拼接成字符串。
    safe(value)：如果开启了全局转义，那么safe过滤器会将变量关掉转义。示例：content_html|safe。
    int(value)：将值转换为int类型。
    float(value)：将值转换为float类型。
    lower(value)：将字符串转换为小写。
    upper(value)：将字符串转换为小写。
    replace(value,old,new)： 替换将old替换为new的字符串。
    truncate(value,length=255,killwords=False)：截取length长度的字符串。
    striptags(value)：删除字符串中所有的HTML标签，如果出现多个空格，将替换成一个空格。
    trim：截取字符串前面和后面的空白字符。
    string(value)：将变量转换成字符串。
    wordcount(s)：计算一个长字符串中单词的个数。
    ```

### 3.if判断：
1. 语法：  
    ```jinja2
    {% if xxx %}
    	<a>满足条件 </a>
    {% else %}
    	<a>不满足执行条件 </a>
    {% endif %}
    ```
2. if的使用，可以和python中相差无几。

### 4.for循环遍历列表和字典：
1. 字典的遍历，语法和`python`一样，可以使用`items()`、`keys()`、`values()`、`iteritems()`、`iterkeys()`、`itervalues()`
    ```jinja2
    {% for k,v in user.items() %}
        <p>{{ k }}:{{ v }}</p>
    {% endfor %}
    ```
2. 列表的遍历：语法和`python`一样。
    ```jinja2
    {% for website in websites %}
        <p>{{ website }}</p>
    {% endfor %}
    ```

### 5.继承和block：
1. 继承作用和语法：
    * 作用：可以把一些公共的代码放在父模板中，避免每个模板写同样的代码。
    * 语法：
        ```jinja2
        {% extends 'base.html' %}
        ```
2. block实现：
    * 作用：可以让子模板实现一些自己的需求。父模板需要提前定义好。
    
    * 注意点：子模板中的代码，必须放在block块中。
    
    ```jinja2
      {% block main %}
      
      {% endblock %}
    ```

url链接：使用`url_for(视图函数名称)`可以反转成url。

### 6.加载静态文件：
1. 语法：`url_for('static',filename='路径')`
2. 静态文件，flask会从`static`文件夹中开始寻找，所以不需要再写`static`这个路径了。
3. 可以加载`css`文件，可以加载`js`文件，还有`image`文件。
    ```html
    第一个：加载css文件
    <link rel="stylesheet" href="{{ url_for('static',filename='css/index.css') }}">
    第二个：加载js文件
    <script src="{{ url_for('static',filename='js/index.js') }}"></script>
    第三个：加载图片文件
    <img src="{{ url_for('static',filename='images/zhiliao.png') }}" alt="">
    ```

### 7.注释

```jinja2
{#  这里输入注释  #}
```

### 8.jinja2 自定义函数

 1. 方案一，通过上下文处理器

    后台写法 [双层闭包，可以实现传参]，【注意返回必须为字典，可以返回变量，函数等】

    ```python
    @app01.context_processor
    def myfunc():
    	def mytype(args):
    		type ={ '1':"book",'2':'apple'}
    	return type
    return dict(mytype_t = mytype)
    ```

    前端jinja调用

    ```jinja2
    {{mytype_t}}   		# 没有参数，直接调用
    {{mytype_t(100)}}	# 有参数，直接传参
    ```

	2. 方案二，通过函数

    ```python
    def myfunc():
    	type ={ '1':"book",'2':'apple'}
    	return type
    
    app01.jinja_env.globals.update(mytype_t = myfunc) # 函数赋值，没有括号，直接复制函数对象地址
    ```

### 9.include

```jinja2
# 直接把a.html的内容拿过来，放在这里
{% include "a.html" %}
```

```jinja2
# 继承模板b.html的内容
{% extends "b.html" %}
```

```jinja2
# 对模板中的block 进行填空
{% block 内容%}
# 保存母版中在这个block中的内容
{% super() %}
{% endblock %}
```

